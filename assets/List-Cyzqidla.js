import{u as ie,D as K,p as R,s as I,h as ae,y as ne,r as m,o as C,A as O,w as a,a as o,G as se,H as ue,m as Y,J as ce,K as de,c as X,i as Z,t as W,d as g,F as me,g as z,_ as oe,M as fe,k as ee,f as T,e as h}from"./index-DmuTLrRo.js";const te={__name:"Permission",props:{anyOf:{type:Array,default:()=>[]},allOf:{type:Array,default:()=>[]}},setup(u){const p=u,l=ie(),c=I(()=>{const i=l.permissions||[],r=Array.isArray(p.anyOf)?p.anyOf:[],d=Array.isArray(p.allOf)?p.allOf:[],x=r.length===0?!0:r.some(v=>i.includes(v)),$=d.length===0?!0:d.every(v=>i.includes(v));return x&&$});return(i,r)=>c.value?K(i.$slots,"default",{key:0}):R("",!0)}},pe={key:0,class:"pro-table-batch-bar"},ve=ae({__name:"ProTable",props:{title:{default:""},columns:{},dataSource:{},loading:{type:Boolean,default:!1},pagination:{},rowSelection:{type:Boolean,default:!1},allowExport:{type:Boolean,default:!0},allowColumnSetting:{type:Boolean,default:!0},storageKey:{default:"pro-table-columns"}},emits:["change","export","batchDelete"],setup(u,{emit:p}){const l=u,c=p,i=z([]),r=z(!1),d=z([]),x=I(()=>l.columns.filter(t=>{const e=t.key||t.dataIndex,n=t.visible!==!1,_=d.value.includes(e);return n&&_})),$=I(()=>l.dataSource.filter(t=>i.value.includes(t.id))),v=I(()=>{const t=l.columns.map(n=>n.key||n.dataIndex),e=d.value.length;return e>0&&e<t.length}),S=I(()=>l.columns.map(e=>e.key||e.dataIndex).every(e=>d.value.includes(e)));function N(t){i.value=t}function j(){i.value=[]}function s(t,e,n){c("change",t,e,n)}function V(){c("export"),G(l.dataSource,{filename:`${l.title||"export"}.csv`})}function D(){r.value=!0}function J(){U()}function H(t){const e=l.columns.map(n=>n.key||n.dataIndex);d.value=t.target.checked?e:[]}function M(){}function q(){const t=l.storageKey,e=localStorage.getItem(t);if(e)try{d.value=JSON.parse(e)}catch{d.value=l.columns.map(n=>n.key||n.dataIndex)}else d.value=l.columns.map(n=>n.key||n.dataIndex)}function U(){const t=l.storageKey;localStorage.setItem(t,JSON.stringify(d.value))}function G(t,e={}){if(!t||t.length===0)return;const n=Object.keys(t[0]),_=n.join(","),w=t.map(E=>n.map(y=>E[y]).join(",")),A=[_,...w].join(`
`),b=new Blob(["\uFEFF"+A],{type:"text/csv;charset=utf-8;"}),k=document.createElement("a"),B=URL.createObjectURL(b);k.setAttribute("href",B),k.setAttribute("download",e.filename||"export.csv"),k.style.visibility="hidden",document.body.appendChild(k),k.click(),document.body.removeChild(k)}return ne(()=>{q()}),(t,e)=>{const n=m("a-space"),_=m("a-button"),w=m("a-table"),A=m("a-checkbox"),b=m("a-divider"),k=m("a-checkbox-group"),B=m("a-drawer"),E=m("a-card");return C(),O(E,{bordered:!1},{title:a(()=>[o(n,null,{default:a(()=>[Z("span",null,W(u.title),1),K(t.$slots,"extra",{},void 0,!0)]),_:3})]),extra:a(()=>[o(n,null,{default:a(()=>[u.allowExport?(C(),O(_,{key:0,onClick:V},{default:a(()=>[...e[2]||(e[2]=[g("导出 CSV",-1)])]),_:1})):R("",!0),u.allowColumnSetting?(C(),O(_,{key:1,onClick:D},{default:a(()=>[...e[3]||(e[3]=[g("列设置",-1)])]),_:1})):R("",!0),K(t.$slots,"toolbar",{},void 0,!0)]),_:3})]),default:a(()=>[o(w,se(t.$attrs,{"row-key":t.rowKey,"row-selection":u.rowSelection?{selectedRowKeys:i.value,onChange:N}:void 0,columns:x.value,"data-source":u.dataSource,loading:u.loading,pagination:u.pagination,onChange:s}),ue({_:2},[Y(t.$slots,(y,L)=>({name:L,fn:a(P=>[K(t.$slots,L,ce(de(P)),void 0,!0)])}))]),1040,["row-key","row-selection","columns","data-source","loading","pagination"]),u.rowSelection&&i.value.length>0?(C(),X("div",pe,[o(n,null,{default:a(()=>[Z("span",null,"已选择 "+W(i.value.length)+" 项",1),o(_,{onClick:j},{default:a(()=>[...e[4]||(e[4]=[g("取消选择",-1)])]),_:1}),K(t.$slots,"batchActions",{selectedRowKeys:i.value,selectedRows:$.value},void 0,!0)]),_:3})])):R("",!0),o(B,{open:r.value,"onUpdate:open":e[1]||(e[1]=y=>r.value=y),title:"列设置",placement:"right",onClose:J},{default:a(()=>[o(n,{direction:"vertical",style:{width:"100%"}},{default:a(()=>[o(A,{indeterminate:v.value,checked:S.value,onChange:H},{default:a(()=>[...e[5]||(e[5]=[g(" 全选 ",-1)])]),_:1},8,["indeterminate","checked"]),o(b),o(k,{value:d.value,"onUpdate:value":e[0]||(e[0]=y=>d.value=y),onChange:M},{default:a(()=>[o(n,{direction:"vertical"},{default:a(()=>[(C(!0),X(me,null,Y(u.columns,y=>(C(),O(A,{key:y.key||y.dataIndex,value:y.key||y.dataIndex},{default:a(()=>[g(W(y.title),1)]),_:2},1032,["value"]))),128))]),_:1})]),_:1},8,["value"])]),_:1})]),_:1},8,["open"])]),_:3})}}}),ye=oe(ve,[["__scopeId","data-v-ca8fe5b2"]]),F=[{id:"u_001",name:"Alice",email:"alice@example.com",role:"admin",createdAt:"2025-11-02 10:12:00"},{id:"u_002",name:"Bob",email:"bob@example.com",role:"editor",createdAt:"2025-11-03 14:20:00"},{id:"u_003",name:"Cindy",email:"cindy@example.com",role:"viewer",createdAt:"2025-11-05 09:01:00"},{id:"u_004",name:"David",email:"david@example.com",role:"viewer",createdAt:"2025-11-06 18:33:00"},{id:"u_005",name:"Eve",email:"eve@example.com",role:"editor",createdAt:"2025-11-08 11:45:00"},{id:"u_006",name:"Frank",email:"frank@example.com",role:"admin",createdAt:"2025-11-10 16:18:00"},{id:"u_007",name:"Grace",email:"grace@example.com",role:"viewer",createdAt:"2025-11-12 08:09:00"},{id:"u_008",name:"Henry",email:"henry@example.com",role:"editor",createdAt:"2025-11-12 20:05:00"},{id:"u_009",name:"Iris",email:"iris@example.com",role:"viewer",createdAt:"2025-11-15 13:40:00"},{id:"u_010",name:"Jack",email:"jack@example.com",role:"admin",createdAt:"2025-11-18 17:22:00"}];function le(u){return new Promise(p=>setTimeout(p,u))}async function ge(u={}){await le(600);const{name:p,role:l,page:c=1,pageSize:i=10}=u;let r=[...F];if(p){const v=String(p).trim().toLowerCase();r=r.filter(S=>S.name.toLowerCase().includes(v))}l&&(r=r.filter(v=>v.role===l));const d=r.length,x=(c-1)*i;return{code:0,data:{rows:r.slice(x,x+i),total:d,page:c,pageSize:i}}}async function _e(u,p){await le(500);const l=F.findIndex(c=>c.id===u);return l===-1?{code:404,message:"用户不存在"}:(F[l].role=p,{code:0,data:F[l]})}const ke={class:"page"},we=ae({__name:"List",setup(u){const p=[{label:"admin",value:"admin"},{label:"editor",value:"editor"},{label:"viewer",value:"viewer"}],l=z(!1),c=T({name:"",role:void 0}),i=T({name:"",role:void 0}),r=T({current:1,pageSize:10,total:0}),d=z([]),x=I(()=>({current:r.current,pageSize:r.pageSize,total:r.total,showSizeChanger:!0,showTotal:t=>`共 ${t} 条`})),$=I(()=>[{title:"Name",dataIndex:"name",key:"name"},{title:"Email",dataIndex:"email",key:"email"},{title:"Role",dataIndex:"role",key:"role"},{title:"Created At",dataIndex:"createdAt",key:"createdAt"},{title:"Actions",key:"actions",width:180}]);async function v(t={}){l.value=!0;try{const e={name:i.name,role:i.role,page:r.current,pageSize:r.pageSize,...t},n=await ge(e);if((n==null?void 0:n.code)!==0||!(n!=null&&n.data)){h.error((n==null?void 0:n.message)||"获取列表失败");return}d.value=n.data.rows,r.total=n.data.total}finally{l.value=!1}}async function S(){r.current=1,i.name=c.name,i.role=c.role,await v({page:1})}async function N(){c.name="",c.role=void 0,await S()}async function j(t){r.current=t.current??1,r.pageSize=t.pageSize??10,await v()}const s=T({open:!1,saving:!1,record:null,role:void 0});function V(t){s.record=t,s.role=t.role,s.open=!0}function D(){s.open=!1,s.record=null,s.role=void 0}async function J(){if(s.record){if(!s.role){h.warning("请选择角色");return}s.saving=!0;try{const t=await _e(s.record.id,s.role);if((t==null?void 0:t.code)!==0){h.error((t==null?void 0:t.message)||"保存失败");return}h.success("保存成功"),D(),await v()}finally{s.saving=!1}}}function H(){h.info("新增：示例占位（请接入真实创建逻辑）")}async function M(t){l.value=!0;try{await new Promise(e=>setTimeout(e,400)),h.success("删除成功"),await v()}finally{l.value=!1}}function q(){h.info("导出 CSV：前端实现（示例）")}async function U(t){console.log("批量删除 ids:",t),h.info(`批量删除 ${t.length} 项（示例）`),await v()}function G(t){U(t)}return ne(()=>{v()}),(t,e)=>{const n=m("a-typography-title"),_=m("a-input"),w=m("a-form-item"),A=m("a-select"),b=m("a-button"),k=m("a-space"),B=m("a-form"),E=m("a-card"),y=m("a-popconfirm"),L=m("a-modal"),P=fe("permission");return C(),X("div",ke,[o(n,{level:4,style:{margin:"0 0 16px"}},{default:a(()=>[...e[4]||(e[4]=[g("用户管理",-1)])]),_:1}),o(E,{bordered:!1,style:{"margin-bottom":"16px"}},{default:a(()=>[o(B,{layout:"inline"},{default:a(()=>[o(w,{label:"姓名"},{default:a(()=>[o(_,{value:c.name,"onUpdate:value":e[0]||(e[0]=f=>c.name=f),placeholder:"请输入 name","allow-clear":"",style:{width:"220px"},onPressEnter:S},null,8,["value"])]),_:1}),o(w,{label:"角色"},{default:a(()=>[o(A,{value:c.role,"onUpdate:value":e[1]||(e[1]=f=>c.role=f),placeholder:"请选择 role","allow-clear":"",style:{width:"180px"},options:p},null,8,["value"])]),_:1}),o(w,null,{default:a(()=>[o(k,null,{default:a(()=>[o(b,{onClick:N},{default:a(()=>[...e[5]||(e[5]=[g("重置",-1)])]),_:1}),o(b,{type:"primary",loading:l.value,onClick:S},{default:a(()=>[...e[6]||(e[6]=[g("查询",-1)])]),_:1},8,["loading"])]),_:1})]),_:1})]),_:1})]),_:1}),o(ye,{title:"用户列表",columns:$.value,"data-source":d.value,loading:l.value,pagination:x.value,"row-selection":"","storage-key":"pro-table-user-list",onChange:j,onExport:q,onBatchDelete:U},{extra:a(()=>[o(te,{"any-of":["user:add"]},{default:a(()=>[o(b,{type:"primary",size:"small",onClick:H},{default:a(()=>[...e[7]||(e[7]=[g("新增",-1)])]),_:1})]),_:1})]),bodyCell:a(({column:f,record:Q})=>[f.key==="actions"?(C(),O(k,{key:0},{default:a(()=>[ee((C(),O(b,{type:"link",onClick:re=>V(Q)},{default:a(()=>[...e[8]||(e[8]=[g("编辑",-1)])]),_:1},8,["onClick"])),[[P,["user:edit"]]]),o(y,{title:"确认删除该用户？",onConfirm:re=>M(Q)},{default:a(()=>[ee((C(),O(b,{type:"link",danger:""},{default:a(()=>[...e[9]||(e[9]=[g("删除",-1)])]),_:1})),[[P,["user:delete"]]])]),_:1},8,["onConfirm"])]),_:2},1024)):R("",!0)]),batchActions:a(({selectedRowKeys:f})=>[o(te,{"any-of":["user:delete"]},{default:a(()=>[o(y,{title:"确认批量删除所选用户？",onConfirm:Q=>G(f)},{default:a(()=>[o(b,{danger:""},{default:a(()=>[...e[10]||(e[10]=[g("批量删除",-1)])]),_:1})]),_:1},8,["onConfirm"])]),_:2},1024)]),_:1},8,["columns","data-source","loading","pagination"]),o(L,{open:s.open,"onUpdate:open":e[3]||(e[3]=f=>s.open=f),title:"编辑用户","confirm-loading":s.saving,onOk:J,onCancel:D,"destroy-on-close":""},{default:a(()=>[o(B,{layout:"vertical"},{default:a(()=>[o(w,{label:"姓名"},{default:a(()=>{var f;return[o(_,{value:(f=s.record)==null?void 0:f.name,disabled:""},null,8,["value"])]}),_:1}),o(w,{label:"邮箱"},{default:a(()=>{var f;return[o(_,{value:(f=s.record)==null?void 0:f.email,disabled:""},null,8,["value"])]}),_:1}),o(w,{label:"角色",required:""},{default:a(()=>[o(A,{value:s.role,"onUpdate:value":e[2]||(e[2]=f=>s.role=f),options:p,placeholder:"请选择 role"},null,8,["value"])]),_:1})]),_:1})]),_:1},8,["open","confirm-loading"])])}}}),Ce=oe(we,[["__scopeId","data-v-f419de09"]]);export{Ce as default};
